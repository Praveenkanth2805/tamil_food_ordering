{% extends "base.html" %}

{% block title %} - Delivery History{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2 class="tamil-title">டெலிவரி வரலாறு</h2>
        <p class="text-muted">Your delivery history and performance</p>
    </div>
</div>

<!-- Stats -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="stat-icon" style="color: #28a745;">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="stat-number">{{ delivery_history|length }}</h2>
            <p class="stat-label">Total Deliveries</p>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="stat-icon" style="color: #ffc107;">
                <i class="fas fa-rupee-sign"></i>
            </div>
            <h2 class="stat-number">
                ₹{{ delivery_history|sum(attribute='final_amount')|round|int }}
            </h2>
            <p class="stat-label">Total Value Delivered</p>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="stat-icon" style="color: #17a2b8;">
                <i class="fas fa-clock"></i>
            </div>
            <h2 class="stat-number">
                {{ (delivery_history|sum(attribute='delivery_time')/delivery_history|length if delivery_history else 0)|round|int }}
            </h2>
            <p class="stat-label">Avg Delivery Time (min)</p>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="stat-card">
            <div class="stat-icon" style="color: #6f42c1;">
                <i class="fas fa-star"></i>
            </div>
            <h2 class="stat-number">4.8</h2>
            <p class="stat-label">Average Rating</p>
        </div>
    </div>
</div>

<!-- Delivery History -->
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-history"></i> Recent Deliveries</h5>
            </div>
            <div class="card-body">
                {% if delivery_history %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Order #</th>
                                <th>Restaurant</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Delivery Time</th>
                                <th>Status</th>
                                <th>Earnings</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for delivery in delivery_history %}
                            <tr>
                                <td>
                                    {{ delivery.updated_at.strftime('%d/%m/%Y') }}<br>
                                    <small class="text-muted">{{ delivery.updated_at.strftime('%H:%M') }}</small>
                                </td>
                                <td>
                                    <strong>{{ delivery.order_number }}</strong><br>
                                    <small class="text-muted">Completed</small>
                                </td>
                                <td>{{ delivery.restaurant_name }}</td>
                                <td>{{ delivery.customer_name }}</td>
                                <td>₹{{ delivery.final_amount }}</td>
                                <td>
                                    {% if delivery.delivery_time %}
                                    <span class="badge bg-info">{{ delivery.delivery_time }} mins</span>
                                    {% else %}
                                    <span class="badge bg-secondary">N/A</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-success">Delivered</span>
                                </td>
                                <td>
                                    <strong>₹{{ (delivery.final_amount * 0.15)|round|int }}</strong><br>
                                    <small class="text-muted">15% commission</small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <div class="mb-3" style="font-size: 4rem; color: #ddd;">
                        <i class="fas fa-history"></i>
                    </div>
                    <h4>No delivery history yet</h4>
                    <p class="text-muted">Your completed deliveries will appear here</p>
                    <div class="mt-3">
                        <a href="{{ url_for('delivery_dashboard') }}" class="btn btn-primary">
                            <i class="fas fa-motorcycle"></i> Start Delivering
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Earnings Summary -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Weekly Earnings</h5>
            </div>
            <div class="card-body">
                <div style="height: 200px; display: flex; align-items: flex-end; gap: 10px; padding: 20px;">
                    {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
                    <div style="flex: 1; text-align: center;">
                        <div style="height: {{ [50, 80, 120, 90, 150, 200, 180]|random }}px; 
                                    background: linear-gradient(to top, #28a745, #20c997); 
                                    border-radius: 5px 5px 0 0;"></div>
                        <small class="d-block mt-2">{{ day }}</small>
                    </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-3">
                    <h5>Weekly Total: ₹1,850</h5>
                    <p class="text-muted">15% commission on ₹12,333 total deliveries</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-award"></i> Performance Metrics</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>On-time Deliveries</span>
                            <span class="badge bg-success">98%</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 98%"></div>
                        </div>
                    </div>
                    
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Customer Rating</span>
                            <span class="badge bg-warning">4.8/5.0</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-warning" style="width: 96%"></div>
                        </div>
                    </div>
                    
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Order Accuracy</span>
                            <span class="badge bg-info">99%</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-info" style="width: 99%"></div>
                        </div>
                    </div>
                    
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Response Time</span>
                            <span class="badge bg-primary">2.5 mins</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 90%"></div>
                        </div>
                    </div>
                    
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Monthly Rank</span>
                            <span class="badge bg-danger">#15</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-danger" style="width: 85%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}